<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socks Checker</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'checker/styles.css' %}">

    <script>
        let intervalId;
        let currentPage = 1;
        const pageSize = 10;
        let results = [];

        function renderTable(page = 1) {
            const tableBody = document.getElementById('results-body');
            tableBody.innerHTML = ''; // Очистить существующие результаты

            const start = (page - 1) * pageSize;
            const end = start + pageSize;
            const pageResults = results.slice(start, end);

            pageResults.forEach((result, index) => {
                const row = document.createElement('tr');
                const numberCell = document.createElement('td');
                numberCell.textContent = start + index + 1;
                row.appendChild(numberCell);

                for (const key in result) {
                    const cell = document.createElement('td');
                    cell.textContent = result[key];
                    row.appendChild(cell);
                }
                tableBody.appendChild(row);
            });

            document.getElementById('current-page').textContent = page;
        }

        async function checkProxies(singleCheck = true) {
            // Имитация вызова функции проверки прокси (замените это реальной логикой)
            results = [
                {ip: '192.168.0.1', port: '8080', protocol: 'socks5', responseTime: '100ms', anonymity: 'high', country: 'США', country_code: 'US'},
                {ip: '192.168.0.2', port: '8080', protocol: 'socks5', responseTime: '150ms', anonymity: 'high', country: 'Канада', country_code: 'CA'},
                // Добавьте больше объектов для имитации
            ];

            renderTable(currentPage);

            if (!singleCheck) {
                intervalId = setInterval(checkProxies, 60000, false); // Проверять каждые 60 секунд
            }
        }

        function startContinuousCheck() {
            checkProxies(false);
        }

        function stopContinuousCheck() {
            clearInterval(intervalId);
        }

        function changePage(increment) {
            const newPage = currentPage + increment;
            const maxPage = Math.ceil(results.length / pageSize);
            if (newPage > 0 && newPage <= maxPage) {
                currentPage = newPage;
                renderTable(currentPage);
            }
        }
    </script>
</head>
<body>
    <header>
        <h1>Socks Checker</h1>
    </header>

    <nav>
        <a href="#home">Старт</a>
        <a href="#about">Описание</a>
        <a href="#faq">FAQ</a>
    </nav>

    <div class="container">
        <h2>Проверка Прокси</h2>
        <button onclick="checkProxies(true)">Однократная проверка</button>
        <button onclick="startContinuousCheck()">Постоянная проверка</button>
        <button onclick="stopContinuousCheck()">Остановить постоянную проверку</button>

        <h3>Проверенные Прокси</h3>
        <table>
            <thead>
                <tr>
                    <th>№</th>
                    <th>IP Адрес</th>
                    <th>Порт</th>
                    <th>Протокол</th>
                    <th>Время ответа</th>
                    <th>Анонимность</th>
                    <th>Страна</th>
                    <th>Код страны</th>
                </tr>
            </thead>
            <tbody id="results-body">
                <!-- Результаты проверки будут добавлены здесь динамически -->
                {% for proxy in proxies %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ proxy.ip }}</td>
                    <td>{{ proxy.port }}</td>
                    <td>{{ proxy.protocol }}</td>
                    <td>{{ proxy.response_time }}</td>
                    <td>{{ proxy.anonymity }}</td>
                    <td>{{ proxy.country }}</td>
                    <td>{{ proxy.country_code }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="pagination">
            <button onclick="changePage(-1)">Предыдущая</button>
            <span id="current-page">1</span>
            <button onclick="changePage(1)">Следующая</button>
        </div>
    </div>
    <div class="timer">
        <p>До окончания проверки осталось приблизительно <span id="timer">0 часов 0 минут 0 секунд</span></p>
    </div>

    <footer>
        <p>&copy; 2025 Socks Checker. Mashn_hu58. ITstep.by.</p>
    </footer>
</body>
</html>
